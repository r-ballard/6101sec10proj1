---
title: "Midterm: Ice Cream"
author: "Alonso Romero, Russ Ballard"
# date: "today"
date: "`r Sys.Date()`"
output:
  html_document:
    code_folding: hide
    number_sections: false
    toc: yes
    toc_depth: 3
    toc_float: yes
  pdf_document:
    toc: yes
    toc_depth: '3'
---

```{r init, include=F}
# The package "ezids" (EZ Intro to Data Science) includes a lot of the helper functions we developed for the course. 
# Some of the frequently used functions are loadPkg(), xkabledply(), xkablesummary(), uzscale(), etc.
# Once installed, load the library.
library(ezids)

set.seed(20052)

pkg_vector <- c("ggplot2",
                "gridExtra",
                "tidyverse",
                "stringi",
                "scales",
                "gridExtra",
                "lubridate",
                "zoo",
                "dplyr",
                "DescTools")

invisible(lapply(pkg_vector,loadPkg))
```


```{r setup, include=FALSE}
# some of common options (and the defaults) are: 
# include=T, eval=T, echo=T, results='hide'/'asis'/'markup',..., collapse=F, warning=T, message=T, error=T, cache=T, fig.width=6, fig.height=4, fig.dim=c(6,4) #inches, fig.align='left'/'center','right', 
# knitr::opts_chunk$set(warning = F, results = "markup", message = F)
knitr::opts_chunk$set(warning = F, results = "hide", message = F)
# knitr::opts_chunk$set(include = F)
# knitr::opts_chunk$set(echo = TRUE)
options(scientific=T, digits = 3) 
# options(scipen=9, digits = 3) 
# ‘scipen’: integer. A penalty to be applied when deciding to print numeric values in fixed or exponential notation.  Positive values bias towards fixed and negative towards scientific notation: fixed notation will be preferred unless it is more than ‘scipen’ digits wider.
# use scipen=999 to prevent scientific notation at all times
```

# The Ice Cream Dataset

Our project uses an Ice Cream dataset that was retrieved from Kaggle from the following website: "https://www.kaggle.com/datasets/tysonpo/ice-cream-dataset/data". The dataset contains a product and review datasets for 4 brands of ice cream, Ben & Jerry's, Häagen-Dazs, Talenti, and Breyers. For the purposes of this project, we will be using a combined dataset provided by the author that combines all the products and reviews of all brands into their respective csv file.

```{r decompress_data, echo=FALSE}

projwd <- getwd()

datadir <- "data"
rawdir <- "raw"
zipf<- "icecream.zip"
outf<-"icecream"

zippath <- file.path(projwd, datadir, rawdir, zipf, fsep="/")
outpath <-file.path(projwd, datadir, rawdir, outf, fsep="/") 
 
unzip(zippath,exdir=outpath)
```
The above chunk abstracts the filepath of the raw `icecream.zip` compressed directory to `data/raw/icecream.zip` within the working directory, which is presumed to be the top level of the repo. The .zip is extracted

```{r load colorbrew}
brandcolorpath <- file.path(projwd, datadir, "processing/brandcolors.csv")
brandcolordf <- data.frame(read.csv(brandcolorpath,
                           header=TRUE,
                           sep=",",
                           quote="\"",
                           colClasses=c("brand"="character",
                                        "color"="character",
                                        "fill"="character")))

brandcolordf
```
A metadata table containing color choices for the different brands has been created, this abstraction can be used for setting colors in the subsequent visualizations for standardizaiton and ease of implementation. 


```{r load_products}
prodcombpath <- file.path(outpath, "combined/products.csv")
products <- data.frame(read.csv(prodcombpath,
                            header=TRUE,
                            sep=",",
                            quote="\"",
                            colClasses=c("brand"="factor",
                                          "key"="character",
                                          "name"="character",
                                          "subhead"="character",
                                          "description"="character",
                                          "rating"="numeric",
                                          "rating_count"="numeric",
                                          "ingredients"="character")))
```


```{r load_reviews}

reviewpath <- file.path(outpath, "combined/reviews.csv")
reviews <- data.frame(read.csv(reviewpath,
                            header=TRUE,
                            sep=",",
                            quote="\"",
                            na.strings=c("","NA"),
                            colClasses=c("brand"="factor",
                                          "key"="character",
                                          "author"="character",
                                          "date"="character",
                                          "stars"="numeric",
                                          "title"="character",
                                          "helpful_yes"="numeric",
                                          "helpful_no"="character",
                                          "text"="character",
                                          "taste"="numeric",
                                          "ingredients"="numeric",
                                          "texture"="character",
                                          "likes"="character")))

reviews$date <- as.Date(reviews$date,'%Y-%m-%d')
```

```{r rowcounts}
nrow_products <- nrow(products)
nrow_reviews <- nrow(reviews)
```

The combined product dataset contains `r nrow_products` data points, and the combined reviews dataset contains `r nrow_reviews` data points.

For the `products.csv` file, the variables in the dataset are:

* `brand`: brand keyword that categorizes each product to its respective brand
* `key`: the primary key that contains a numerical value and the brand keyword
* `name`: the product name
* `subhead`: simple description of the product (used for Ben & Jerry's products only)
* `description`: detailed description of the product
* `rating`: a star rating scale with a range of 1.0 to 5.0
* `rating_count`: amount of ratings for the product
* `ingredients`: ingredient list of the product

For the `reviews.csv` file, the variables in the dataset are:

* `brand`: brand keyword that categorizes each product to its respective brand
* `key`: foreign key that matches to key in `products.csv`
* `author`: the username of the reviewer
* `date`: date that review was posted
* `stars`: reviewer rating of the product
* `title`: reviewer-created title of their review
* `helpful_yes`: amount of users that found the review helpful
* `helpful_no`: amount of users that found the review not helpful
* `text`: the text-based review
* `taste`: reviewer rating of product taste in a range of 1.0 to 5.0  (For Häagen-Dazs products only)
* `ingredients`: reviewer rating of product ingredients in a range of 1.0 to 5.0 (For Häagen-Dazs products only)
* `texture`: reviewer rating of product texture in a range of 1.0 to 5.0 (For Häagen-Dazs products only)
* `likes`: reviewer likes from a preset list to choose from (For Häagen-Dazs products only)

Regarding the dataset, there are important considerations that the author provides for users. First, "the collection of reviews on the brand websites may not be representative of overall opinion, i.e. there may be review censoring or presence of fake reviews meant to help/harm the image of the brand" (Pond, 2020). In order to combat this, the author, "intentionally chose brands that host some negative reviews on their website" (Pond, 2020). Next, the author acknowledges the parent companies of each of the brands. "Ben & Jerry's, Breyers, and Talenti are all owned by Uniever. Häagen-Dazs is owned by Froneri" (Pond, 2020). It is also important to note that, "Talenti is distinguished from the other brands as they produce gelato" (Pond, 2020).

```{r colrenames, echo=FALSE}
colnames(products)[1:8]=c("Brand", "ProductID", "ProductName", "Subhead","ProductDescription", "Rating", "RatingCount", "Ingredients")
# xkabledplyhead(products, title = "Product header rows")

colnames(reviews)[1:13]=c("Brand", "ProductID", "Username", "Date", "Stars", "Title", "Helpful", "Not Helpful", "Review", "Taste", "Ingredients", "Texture", "Likes")
# xkabledplyhead(reviews, title = "Review header rows")
```

```{r productindicators}
products$HAS_VANILLA <- as.factor(as.integer(grepl(pattern = "VANILLA", x = products$Ingredients)))
products$HAS_ORGANIC <- as.factor(as.integer(grepl(pattern = "ORGANIC", x = products$Ingredients)))
products$HAS_CARAMEL <- as.factor(as.integer(grepl(pattern = "CARAMEL", x = products$Ingredients)))

fruitvec <- c("RASPBERR","CHERR","BLUEBERR","BANANA")
products$HAS_FRUIT <- as.factor(as.integer(grepl(pattern=paste(fruitvec,collapse="|"), x=products$Ingredients)))

chocvec <- c("CHOCOLAT","COCO")
products$HAS_CHOCOLATE <- as.factor(as.integer(grepl(pattern=paste(chocvec,collapse="|"), x=products$Ingredients)))

products$IS_BAR <- as.factor(as.integer(grepl(pattern = "BAR", x = products$ProductName) | 
                                grepl(pattern = "BAR", x = products$Subhead)))
```
Using `grepl` we are able to implement regex matching to create additional binary indicator fields for ingredients in the `products` dataframe. 

The additional fields:

* __HAS_VANILLA__ - `products` records with the substring `VANILLA` in their `Ingredients` field
* __HAS_ORGANIC__ - `products` records with the substring `ORGANIC` in their `Ingredients` field
* __HAS_CARAMEL__ - `products` records with the substring `VANILLA` in their `Ingredients` field
* __HAS_FRUIT__ - `products` records with the substrings `RASPBERR`,`CHERR`,`BLUEBERR`, or `BANANA` in their `Ingredients` field
* __HAS_CHOCOLATE__ - `products` records with the substrings `CHOCOLAT`or `COCO` in their `Ingredients` field

This categorization and string parsing would be a key part of any clustering analysis performed on the data and there is much to be gleaned from additional analysis on the `Ingredients` field, though this is beyond the scope of this report.

```{r joinproductreview}

productreview <- left_join(reviews,
                           products %>% select(ProductID,
                                                 HAS_CARAMEL,
                                                 HAS_CHOCOLATE,
                                                 HAS_FRUIT,
                                                 HAS_VANILLA,
                                                 HAS_ORGANIC,
                                                 IS_BAR),
                           by="ProductID", multiple="all")
```

```{r kablesummaries, results='markup'}
xkablesummary(products, title = "Summary of the products dataset")
xkablesummary(reviews, title = "Summary of the reviews dataset")
```

# Exploratory Data Analysis

#### For this project we will be addressing the following questions: Are there differences amongst the different brands in terms of ratings or discernable themes in the product reviews? And is there independence between ice cream ingredient content and review rating?

We will explore the Ice Cream dataset by creating graphs, performing tests, and finding the measures of central tendency and variation. First, we'll look at the overall dataset, and then the individual datasets of each of the four brands.

```{r}
library(ggplot2)
ggplot(data=products, aes(Rating)) +
  geom_histogram(col='blue', fill='lightblue', alpha=0.7) +
    labs(x="Rating", y="Frequency") +
    labs(title="Ice Cream Product Rating Histogram using `ggplot`") +
    theme(plot.title = element_text(hjust = 0.5))
```

This histogram shows the overall ratings of all ice-cream products across all 4 brands of ice-cream. We can see that there is a high frequency of ratings within the 4 - 5 star range. Based on the histogram above, we can see a left skewed distribution. To further test the skewness, we will perform a QQ plot.

```{r}
sd.ratings <- sd(products$Rating)
mean.ratings <- mean(products$Rating)
sd.ratings
mean.ratings
```

The mean of the data above is `r mean.ratings` and the standard deviation is `r sd.ratings`

```{r}
qqnorm(products$Rating, main="QQ plot of Product Ratings")
qqline(products$Rating)
```

Based on the Q-Q plot above, we see that the graph is displaying a left skew as most of the data points are within the third to fifth sample quantile. Therefore this graph displays that the dataset does not present a normal distribution. To further test for normality, the Shapiro-Wilk test is conducted below.

```{r results='markup'}
shapiro.test(products$Rating)
```

For the Shapiro-Wilk test, we are given the following hypotheses:

* `Null Hypothesis`: The sample comes from a normally distributed population
* `Alternative Hypothesis`: The sample does not come from a normally distributed population

Based on the results of the test, the p-value is less than the significance level of 0.05, which means that we reject the null hypothesis and conclude that the data from the sample does not come from a normally distributed population.

#### Measures of Central Tendency

With the combined dataset, we will calculate the mean, median, and mode for this dataset.

```{r echo=FALSE}
mean.rating <- mean(products$Rating)
median.rating <- median(products$Rating)
mode.rating <- names(table(products$Rating))[table(products$Rating) == max(table(products$Rating))]
```

* `Mean`: `r mean.rating`
* `Median`: `r median.rating`
* `Mode`: `r mode.rating`

Based on these results, this further proves that the data is left skewed since the mean is the lowest value followed by the median and the the mode being the highest value.

#### Measures of Variation

With the combined dataset, we will calculate the range, mean deviation, standard deviation, and variance.

```{r echo=FALSE}
range.rating <- range(products$Rating)
md.rating <- mean(abs(products$Rating - mean.rating))
sd.rating <- sd(products$Rating)
variance.rating <- var(products$Rating)

```

* `Range`: `r range.rating`
* `Mean Deviation`: `r md.rating`
* `Standard Deviation`: `r sd.rating`
* `Variance`: `r variance.rating`

With the dataset, we are given data that ranges between `r range.rating[2] - range.rating[1]` ratings points between the lowest rating and the highest rating. The mean deviation shows us that on average, each value in the dataset is about `r mean(abs(products$Rating - mean.rating))` away from the mean. The standard deviation shows us that the data is dispersed `r (products$Rating)` points in relation to the mean. The variance shows that each data point is about `r var(products$Rating)` points away from the mean and other data points in the dataset.

```{r}
z4rating <- (4 - mean.ratings)/sd.ratings
```
We will generate a z-score for a rating of 4 in our distribution.

By taking the value of 4 and subtracting it with the mean `r mean.ratings` and dividing everything by the standard deviation of `r sd(products$Rating)`, we get the z score of `r z4rating`.

Based on this result, we can determine that a rating of 4 lays within the range of the mean and one standard deviation to the left in our distribution.

```{r}
pnorm.rating <- pnorm(z4rating)
```

By taking the `pnorm()` function, `r pnorm.rating` is the probability that a rating of `4` is under the distribution.

```{r, message=FALSE, warning=FALSE, results='markup'}
loadPkg("Hmisc")
describe(products$Rating)
```
Describe the overall data by using the the `describe()` function to highlight the ratings column.


```{r ratingpanelhist}
ggplot(data = productreview, aes (x = Stars, color=Brand, fill = Brand)) + 
  geom_histogram(binwidth=1,boundary=-.5) +
  labs(title="Distribution of Star Ratings \nFor Icecream Brand",
   x="Star Rating",
   y="Review Count\n(in Thousands)") +
  scale_y_continuous(labels = unit_format(unit = "", scale = 1e-3)) +
  facet_grid(Brand ~ .) +
  scale_fill_manual(values=brandcolordf$fill) +
  scale_colour_manual(values=brandcolordf$color) +
  theme(plot.title = element_text(hjust = 0.5))
```

A faceted histogram of star ratings for product reviews. We can observe that the data is as described in the brief and highly clustered around 5's.


```{r contingencyplot}

brandrating_contingency_table<-table(productreview$Brand,productreview$Stars, dnn=c("Brand", "Star Rating"))

brandrating_contingency_table
prop.table(brandrating_contingency_table,margin=1)

mosaicplot(brandrating_contingency_table)
```

Above is the contingency table for the brand product-reviews. We can see that the proportions are as described in the histogram, largely 5's for all brands. Interestingly, Breyer's appears to have a larger proportion of 1's than the other groups.

### Ben & Jerry's

Ben & Jerry's mission for their products is to "make, distribute, and sell the finest-quality ice cream and euphoric concoctions with a continued commitment to incorporating wholesome, natural ingredients and promoting business practices that respect the Earth and the Environment" ("Our Values, Activism, and Mission", n.d.)

```{r bjhist}
bj_data <- subset(products, Brand == "bj")

bjcol <- brandcolordf$color[brandcolordf$brand=="bj"]
bjfill <- brandcolordf$fill[brandcolordf$brand=="bj"]

ggplot(bj_data, aes(Rating)) +
  geom_histogram(col=paste(bjcol), fill=paste(bjfill), alpha=0.7) +
  labs(x="Rating", y="Frequency") +
  labs(title="Ben & Jerry's Product Rating Histogram using `ggplot`") +
  theme(plot.title = element_text(hjust = 0.5))
```

```{r}
mean.bjratings <- mean(bj_data$Rating)
sd.bjratings <- sd(bj_data$Rating)
```

Looking at the graph, it is very similar to the histogram of all four brands combined, where it shows a left skewed distribution.
The mean of the data above is `r mean.bjratings` and the standard deviation is `r sd.bjratings`

```{r}
#Color and fill are inverted here for readability
ggplot(bj_data, aes(x=ProductID, y=Rating)) +
  geom_point(col=paste(bjfill), fill=paste(bjfill), alpha=0.7) +
  labs(x="ProductID", y='Rating') +
  labs(title="Ratings for each individual Ben & Jerry's products") + 
  theme(axis.text.x = element_text(angle=90, hjust=1, size = 5)) +
  theme(plot.title = element_text(hjust = 0.5))
```
Here is a chart depicting average rating for each Ben and Jerry's product. This data could be further parsed to give indication of ingredient contents.


```{r}
# Finding the highest rated products
max_rating_index <- which(bj_data$Rating == max(bj_data$Rating))
max_productname <- bj_data$ProductName[max_rating_index]

# Finding the lowest rated products
min_rating_index <- which(bj_data$Rating == min(bj_data$Rating))
min_productname <- bj_data$ProductName[min_rating_index]
```

Based on the `Rating` data, the highest rated Ben & Jerry's product is a tie between: `r max_productname[0]` and `r max_productname[1]` 

```{r, echo=FALSE, results='markup'}
bj7_top <- subset(productreview, ProductID == "7_bj")
bj7_top_reviews <- bj7_top[, c("Review")]
head(bj7_top_reviews)
```

Above we see the first 6 reviews of Ben & Jerry's Chocolate Peanut Butter Split ice cream. Based from these reviews, customers absolutely love this flavor as it is unique by having banana and also having peanut butter cups in the ice cream.

```{r, echo=FALSE, results='markup'}
bj31_top <- subset(productreview, ProductID == "31_bj")
bj31_top_reviews <- bj31_top[, c("Review")]
head(bj31_top_reviews)
```

Above we see the first 6 reviews of Ben & Jerry's Ice Cream Sammie. Based on these reviews, customers are willing to travel far to get a hold of this product. This also serves as a problem as it is hard to find. Another issue stated is that there have been pints where there were little to no chocolate chunks. However, the customers overall love the product.


Based from the graph, the lowest rated Ben & Jerry's products: `r min_productname`
```{r, echo=FALSE, results='markup'}
bj_low <- subset(productreview, ProductID == "50_bj")
bj_low_reviews <- bj_low[, c("Review")]
head(bj_low_reviews)
```

Above we see the first 6 reviews of Ben & Jerry's Chocolate Chip Cookie Dough Core. Customers were disappointed as the cookie dough core was either lacking or completely absent. When there was a a bit of dough in the core, it did not meet customers' expectations as many claim that it does not taste like cookie dough.


#### Measures of Central Tendency

With the Ben & Jerry's data subset, we will calculate the mean, median, and mode for this dataset.

```{r echo=FALSE}
mean.bjrating <- mean(bj_data$Rating)
median.bjrating <- median(bj_data$Rating)
mode.bjrating <- names(table(bj_data$Rating))[table(bj_data$Rating) == max(table(bj_data$Rating))]
```

* `Mean`: `r mean.bjrating`
* `Median`: `r median.bjrating`
* `Mode`: `r mode.bjrating`

The measures of central tendency shows us that the average rating is `r mean.bjrating`, a median rating of `r median.bjrating`, with a rating of `r mode.bjrating` appearing most often from reviewers. Continuing on the trend from the overall ice cream flavors, the measures of central tendency for Ben & Jerry's data display a left skewed distribution since mean < median < mode. 

#### Measures of Variation

With the Ben & Jerry's data subset, we will calculate the range, mean deviation, standard deviation, and variance.

```{r echo=FALSE}
range.bjrating <- range(bj_data$Rating)
md.bjrating <- mean(abs(bj_data$Rating - mean.bjrating))
sd.bjrating <- sd(bj_data$Rating)
variance.bjrating <- var(bj_data$Rating)
```

* `Range`: `r range.bjrating`
* `Mean Deviation`: `r md.bjrating`
* `Standard Deviation`: `r sd.bjrating`
* `Variance`: `r variance.bjrating`

With the Ben & Jerry's dataset, the data ranges `r range.bjrating[2] - range.bjrating[1]` data points from the lowest point to the highest point. The mean deviation here shows us that on average, each value in the dataset is about `r md.bjrating` points away from the mean. The standard deviation shows us that the data is dispersed `r sd.bjrating` points in relation to the mean. The variance shows that each data point is about `r variance.bjrating` points away from the mean and other data points in the dataset.

### Häagen-Dazs

Since 1960, Häagen Dazs kept their mission simple, "source the finest ingredients and transform them into the most luxurious ice cream. Because [they] believe that luxury is found wherever you are - in moments large and small" ("About Us", n.d.).

```{r}
hd_data <- subset(products, Brand == "hd")

hdcol <- brandcolordf$color[brandcolordf$brand=="hd"]
hdfill <-brandcolordf$fill[brandcolordf$brand=="hd"]

ggplot(hd_data, aes(Rating)) +
  geom_histogram(col=paste(hdcol), fill=paste(hdfill), alpha=0.7) +
  labs(x="Rating", y="Frequency") +
  labs(title="Haagen-Dazs' Product Rating Histogram using `ggplot`") +
  theme(plot.title = element_text(hjust = 0.5))
```

```{r}
mean.hdratings <- mean(hd_data$Rating)
sd.hdratings <- sd(hd_data$Rating)
```

From the graph, we can see that data is more concentrated equally to the right of the graph, which the data also presents a left skewed distribution.
The mean of the data above is `r mean.hdratings` and the standard deviation is `r sd.hdratings`

```{r}
ggplot(hd_data, aes(x=ProductID, y=Rating)) +
  geom_point(col=paste(hdcol), fill=paste(hdfill), alpha=0.7) +
  labs(x="ProductID", y='Rating') +
  labs(title="Ratings for each individual Haagen-Dazs products") + 
  theme(axis.text.x = element_text(angle=90, hjust=1, size = 5)) +
  theme(plot.title = element_text(hjust = 0.5))
```

```{r}
# Finding the highest rated products
max_rating_index <- which(hd_data$Rating == max(hd_data$Rating))
max_productname <- hd_data$ProductName[max_rating_index]

# Finding the lowest rated products
min_rating_index <- which(hd_data$Rating == min(hd_data$Rating))
min_productname <- hd_data$ProductName[min_rating_index]
```

Based from the graph, the highest rated Häagen-Dazs products: `r max_productname`
```{r, echo=FALSE, results='markup'}
hd14_top <- subset(productreview, ProductID == "14_hd")
hd14_top_reviews <- hd14_top[, c("Review")]
head(hd14_top_reviews)
```

Above are the first 6 reviews of Häagen-Dazs' Chocolate Fudge Non-Dairy Bar. Customers that are lactose intolerant absolutely love this product. Having tried other non-dairy products from other brands, customers rate this product above all as the flavor tastes amazing for a non-dairy product.

```{r, echo=FALSE, results='markup'}
hd31_top <- subset(productreview, ProductID == "31_hd")
hd31_top_reviews <- hd31_top[, c("Review")]
head(hd31_top_reviews)
```

Above are the first 6 reviews of Häagen-Dazs' Honey Salted Caramel Almond Ice Cream. Customers absolutely love this flavor and considering it as their favorite flavor and eating multiple pints in one day.

```{r, echo=FALSE, results='markup'}
hd43_top <- subset(productreview, ProductID == "43_hd")
hd43_top_reviews <- hd43_top[, c("Review")]
head(hd43_top_reviews)
```

Above are the first 6 reviews of Häagen-Dazs' Peppermint Bark Ice Cream. Customers absolutely love this flavor. The only issue that was stated in the reviews is that this product is not available year-round, only in December.

```{r, echo=FALSE, results='markup'}
hd44_top <- subset(productreview, ProductID == "44_hd")
hd44_top_reviews <- hd44_top[, c("Review")]
head(hd44_top_reviews)
```

Above are the first 6 reviews of Häagen-Dazs' Peppermint Bark Ice Cream Bar. This product is the bar version of the Peppermint Bark Ice Cream above. Customers love that there are multiple bars, and complain on the product not being available year-round.

```{r, echo=FALSE, results='markup'}
hd63_top <- subset(productreview, ProductID == "63_hd")
hd63_top_reviews <- hd63_top[, c("Review")]
head(hd63_top_reviews)
```

Above are the first 6 reviews of Häagen-Dazs' Vanilla Caramel White Chocolate Trio Crispy Layers. Customers are obsessed with the flavor combination, the creamy texture, and are just overall satisfied with the product.

Based from the graph, the lowest rated Häagen-Dazs product: `r min_productname`
```{r, echo=FALSE, results='markup'}
hd_low <- subset(productreview, ProductID == "66_hd")
hd_low_reviews <- hd_low[, c("Review")]
head(hd_low_reviews)
```

Above are the first 6 reviews of Häagen-Dazs' Vanilla Milk Chocolate Almond Ice Cream Bar. The customers complained that the quality of the product not meeting their expectations. Others complained about the lack of almonds in the bar and a thinner layer of chocolate. 

#### Measures of Central Tendency

With the Häagen Dazs data subset, we will calculate the mean, median, and mode for this dataset.

```{r echo=FALSE}
mean.hdrating <- mean(hd_data$Rating)
median.hdrating <- median(hd_data$Rating)
mode.hdrating <- names(table(hd_data$Rating))[table(hd_data$Rating) == max(table(hd_data$Rating))]
```

* `Mean`: `r mean.hdrating`
* `Median`: `r median.hdrating`
* `Mode`: `r mode.hdrating`

The measures of central tendency shows us that the average rating is `r mean.hdrating`, a median rating of `r median.hdrating`, and with the ratings of `r mode.hdrating[1]` and `r mode.hdrating[2]` tied for being awarded the most often by reviewers. These values also show that the data displays a left skewed distribution.

#### Measures of Variation

With the Häagen Dazs data subset, we will calculate the range, mean deviation, standard deviation, and variance.

```{r echo=FALSE}
range.hdrating <- range(hd_data$Rating)
md.hdrating <- mean(abs(hd_data$Rating - mean.hdrating))
sd.hdrating <- sd(hd_data$Rating)
variance.hdrating <- var(hd_data$Rating)
```

* `Range`: `r range.hdrating`
* `Mean Deviation`: `r md.hdrating`
* `Standard Deviation`: `r sd.hdrating`
* `Variance`: `r variance.hdrating`

With the Häagen-Dazs dataset, the data ranges `r range.hdrating[2] - range.hdrating[1]` data points from the lowest point to the highest point. The mean deviation here shows us that on average, each value in the dataset is about `r md.hdrating` points away from the mean. The standard deviation shosw us that the data is dispersed `r sd.hdrating` points in relation to the mean. The variance shows that each data point is about `r variance.hdrating` points away from the mean and other data points in the dataset.

### Talenti

Talenti strives to "travel the world over to source the highest quality ingredients. Whether it's fragrant vanilla beans from Madagascar, or creamy mangos from Maharashta, [they] always start with real ingredients for the most authentic flavors" ("Our Process", n.d.).

```{r}
talenti_data <- subset(products, Brand == "talenti")

talcol <- brandcolordf$color[brandcolordf$brand=="talenti"]
talfill <-brandcolordf$fill[brandcolordf$brand=="talenti"]

ggplot(talenti_data, aes(Rating)) +
  geom_histogram(col=paste(talcol), fill=paste(talfill), alpha=0.7) +
  labs(x="Rating", y="Frequency") +
  labs(title="Talenti's Product Rating Histogram using `ggplot`") +
  theme(plot.title = element_text(hjust = 0.5))
```

```{r}
mean.talratings <- mean(talenti_data$Rating)
sd.talratings <- sd(talenti_data$Rating)
```

From the graph, we can see that there are not as many products within the Talenti brand when compared to the other brands. We can also the graph displays a left-skewed distribution.
The mean of the data above is `r mean.talratings` and the standard deviation is `r sd.talratings`

```{r}
ggplot(talenti_data, aes(x=ProductID, y=Rating)) +
  geom_point(col=paste(talcol), fill=paste(talfill), alpha=0.7) +
  labs(x="ProductID", y='Rating') +
  labs(title="Ratings for each Individual Talenti Products") + 
  theme(axis.text.x = element_text(angle=90, hjust=1, size = 5)) +
  theme(plot.title = element_text(hjust = 0.5))
```

```{r}
# Finding the highest rated products
max_rating_index <- which(talenti_data$Rating == max(talenti_data$Rating))
max_productname <- talenti_data$ProductName[max_rating_index]

# Finding the lowest rated products
min_rating_index <- which(talenti_data$Rating == min(talenti_data$Rating))
min_productname <- talenti_data$ProductName[min_rating_index]
```

Based from the graph, the highest rated Talenti products: `r max_productname`
```{r, echo=FALSE, results='markup'}
tal2_top <- subset(productreview, ProductID == "2_talenti")
tal2_top_reviews <- tal2_top[, c("Review")]
head(tal2_top_reviews)
```

Above are the first 6 reviews of Talenti's Belgian Chocolate Gelato. Customers praise the rich and creaminess flavor as well as the use of Belgian chocolate exceeds customers' expectations.

```{r, echo=FALSE, results='markup'}
tal5_top <- subset(productreview, ProductID == "5_talenti")
tal5_top_reviews <- tal5_top[, c("Review")]
head(tal5_top_reviews)
```

Above are the first 6 reviews of Talenti's Caramel Apple Pie Gelato. Customers love the rich and creamy texture, with the flavor not being too overbearing but still good. The only complaint is that the product is only available seasonally and not year-round.

```{r, echo=FALSE, results='markup'}
tal11_top <- subset(productreview, ProductID == "11_talenti")
tal11_top_reviews <- tal11_top[, c("Review")]
head(tal11_top_reviews)
```

Above are the first 6 reviews of Talenti's Almond Chocolate Gelato. Customers praise the coconut, almond, and chocolate combination. Since this flavor is well-received, it is often hard to find in stores, and when there are products in stock, customers would grab more than one pint.

```{r, echo=FALSE, results='markup'}
tal30_top <- subset(productreview, ProductID == "30_talenti")
tal30_top_reviews <- tal30_top[, c("Review")]
head(tal30_top_reviews)
```

Above are the first 6 reviews of Talenti's Organic Oak-aged Vanilla Gelato. Customers love the flavor along with its creamy texture to the point where many claim for it to be their favorite flavor. 


Based from the graph, the lowest rated Talenti product: `r min_productname`
```{r, echo=FALSE, results='markup'}
tal_low <- subset(productreview, ProductID == "9_talenti")
tal_low_reviews <- tal_low[, c("Review")]
head(tal_low_reviews)
```

Above we see the first 6 reviews of Talenti's Chocolate Chip Cookie Dough Gelato. Customers complained about the lack of cookie dough, the poor taste of the flavor, and occasionally an uneven distribution of vanilla and chocolate.


#### Measures of Central Tendency

With the Talenti data subset, we will calculate the mean, median, and mode for this dataset.

```{r echo=FALSE}
mean.talrating <- mean(talenti_data$Rating)
median.talrating <- median(talenti_data$Rating)
mode.talrating <- names(table(talenti_data$Rating))[table(talenti_data$Rating) == max(table(talenti_data$Rating))]
```

* `Mean`: `r mean.talrating`
* `Median`: `r median.talrating`
* `Mode`: `r mode.talrating`

The measures of central tendency show that the average rating is `r mean.talrating`, a median rating of `r median.talrating`, and having a rating of `r mode.talrating` awarded the most. Like the other brands, a left skewed distribution is displayed from the data.

#### Measures of Variation

With the Talenti data subset, we will calculate the range, mean deviation, standard deviation, and variance.

```{r echo=FALSE}
range.talrating <- range(talenti_data$Rating)
md.talrating <- mean(abs(talenti_data$Rating - mean.talrating))
sd.talrating <- sd(talenti_data$Rating)
variance.talrating <- var(talenti_data$Rating)
```

* `Range`: `r range.talrating`
* `Mean Deviation`: `r md.talrating`
* `Standard Deviation`: `r sd.talrating`
* `Variance`: `r variance.talrating`

With the Talenti dataset, the data ranges `r range.talrating[2] - range.talrating[1] ` data points from the lowest point to the highest point. The mean deviation here shows us that on average, each value in the dataset is about `r md.talrating` points away from the mean. The standard deviation shosw us that the data is dispersed `r sd.talrating` points in relation to the mean. The variance shows that each data point is about `r variance.talrating` points away from the mean and other data points in the dataset.

### Breyers

Breyers is committed on using high quality ingredients. Breyers "start with high ingredients like colors and flavors from natural sources and sustainably farmed vanilla. [They] partner with American farmers for 100% Grade A milk and cream that comes from cows not treated with artificial growth hormones" ("About Breyers History", n.d.).
 
```{r breyershist}
breyers_data <- subset(products, Brand == "breyers")

breycol <- brandcolordf$color[brandcolordf$brand=="breyers"]
breyfill <-brandcolordf$fill[brandcolordf$brand=="breyers"]

ggplot(breyers_data, aes(Rating)) +
  geom_histogram(col=breycol, fill=breyfill, alpha=0.7) +
  labs(x="Rating", y="Frequency") +
  labs(title="Breyers' Product Rating Histogram using `ggplot`") +
  theme(plot.title = element_text(hjust = 0.5))
```

```{r breyerssummarystat}
mean.breyratings <- mean(breyers_data$Rating)
sd.breyratings <- sd(breyers_data$Rating)
```

From the graph, the breyers data is similar to the histogram of Ben & Jerry's and the combined dataset. The graph also displays a left-skewed distribution.
The mean of the data above is `r mean.breyratings` and the standard deviation is `r sd.breyratings`

```{r breyersprodratings}
#color and fill are inverted here for readability
ggplot(breyers_data, aes(x=ProductID, y=Rating)) +
  geom_point(col=breyfill, fill=breycol, alpha=0.7) +
  labs(x="ProductID", y='Rating') +
  labs(title="Ratings for each individual Breyers products") + 
  theme(axis.text.x = element_text(angle=90, hjust=1, size = 5)) +
  theme(plot.title = element_text(hjust = 0.5))
```

```{r breyersextrema}
# Finding the highest rated products
max_rating_index <- which(breyers_data$Rating == max(breyers_data$Rating))
max_productname <- breyers_data$ProductName[max_rating_index]

# Finding the lowest rated products
min_rating_index <- which(breyers_data$Rating == min(hd_data$Rating))
min_productname <- breyers_data$ProductName[min_rating_index]
```

Based from the graph, the highest rated Breyers product: `r max_productname`

```{r, echo=FALSE, results='markup'}
breyers_top <- subset(productreview, ProductID == "41_breyers")
breyers_top_reviews <- breyers_top[, c("Review")]
breyers_top_reviews
```

Above are the two reviews of Breyers' Oreo Snack Cups 10ct. Both reviews praise on how the ice cream is portioned out.

Based from the graph, the lowest rated Breyers product: `r min_productname`

```{r, echo=FALSE, results='markup'}
breyers_low <- subset(productreview, ProductID == "66_breyers")
breyers_low_reviews <- breyers_low[, c("Review")]
head(breyers_low_reviews)
```

Above are the first 6 reviews of Breyers' Layered Dessert S'mores. Customers complained on how the product does not taste like s'mores. Specifically, the marshmellows and graham crackers was either lacking or tasted awful, and the overall taste of what customers expected for s'mores did not meet their expectations. Though some customers actually like the product.

#### Measures of Central Tendency

With the Breyers data subset, we will calculate the mean, median, and mode for this dataset.

```{r echo=FALSE}
mean.breyrating <- mean(breyers_data$Rating)
median.breyrating <- median(breyers_data$Rating)
mode.breyrating <- names(table(breyers_data$Rating))[table(breyers_data$Rating) == max(table(breyers_data$Rating))]
```

* `Mean`: `r mean.breyrating`
* `Median`: `r median.breyrating`
* `Mode`: `r mode.breyrating`

The measures of central tendency show that the average rating is `r mean.breyrating`, the median rating is `r median.breyrating`, with a score of `r mode.breyrating` appearing most often. Again like the other brands, these values prove that the data displays a left skewed distribution.

#### Measures of Variation

With the Breyers data subset, we will calculate the range, mean deviation, standard deviation, and variance.

```{r echo=FALSE}
range.breyrating <- range(breyers_data$Rating)
md.breyrating <- mean(abs(breyers_data$Rating - mean.breyrating))
sd.breyrating <- sd(breyers_data$Rating)
variance.breyrating <- var(breyers_data$Rating)
```

* `Range`: `r range.breyrating`
* `Mean Deviation`: `r md.breyrating`
* `Standard Deviation`: `r sd.breyrating`
* `Variance`: `r variance.breyrating`

With the Breyers dataset, the data ranges `r range.breyrating[2] - range.breyrating[1]` data points from the lowest point to the highest point. The mean deviation here shows us that on average, each value in the dataset is about `r md.breyrating` points away from the mean. The standard deviation shows us that the data is dispersed `r sd.breyrating` points in relation to the mean. The variance shows that each data point is about `r variance.breyrating` points away from the mean and other data points in the dataset.


## EDA Conclusion

Based on the results of the EDA testing, we can conclude for each of the following for each brand.

* `Ben & Jerry's`: The average of the dataset is `r mean.bjratings`, with a standard deviation of `r sd.bjratings` above and below the mean. There are two products that received the highest rating: Chocolate Peanut Butter Split and Ice Cream Sammie, and one product that received the lowest ranking, Chocolate Chip Cookie Dough Core.
* `Häagen-Dazs`: The average of the dataset is `r mean.hdratings`, with a standard deviation of `r sd.hdratings`. There are five products that received the highest ranking, Chocolate Fudge Non-Dairy Bar, Honey Salted Caramel Almond Ice Cream, Peppermint Bark Ice Cream, Peppermint Bark Ice Cream Bar, and Vanilla Caramel White Chocolate Trio Crispy Layers, and one product that received the lowest ranking, Vanilla Milk Chocolate Almond Ice Cream Bar.
* `Talenti`: The average of the dataset is `r mean.talratings`, with a standard deviation of `r sd.talratings` above and below the mean. There are four products that received the highest ranking: Belgian Chocolate Gelato, Caramel Apple Pie Gelato, Coconut Almond Chocolate Gelato, and Organic Oak-Aged Vanilla Gelato; and there is one product that received the lowest ranking: Chocolate Chip Cookie Dough Gelato.
* `Breyers`: The average of the dataset is `r mean.breyratings`, with a standard deviation of `r sd.breyratings` above and below the mean. There is one product that has received the highest ranking: Oreo Snack Cups 10ct; and one product has received the lowest rating: Layered Dessert S'mores.

From the information above we can determine the following

* The flavor Chocolate Chip Cookie Dough has appeared twice for being the least rated flavor across all brands
* Talenti has the highest average rating compared to the other brands, whereas Breyers has the lowest average rating across all brands.
* All of the brands display a left-skewed distribution.
* Common complaints are lacking or non-existent toppings, flavors not meeting customers' expectations,


# Hypothesis Testing
### Ingredient Indicators
```{r ingredientviolinplots}
chocvio <- ggplot(productreview,aes(HAS_CHOCOLATE,Stars)) +
  geom_violin(aes(fill=HAS_CHOCOLATE)) + 
  scale_fill_manual(values=c("grey","chocolate4")) +
    labs(title="Distn of Ratings For Icecreams \nBy Contains Chocolate Indicator",
       x="Contains Chocolate",
       y="Rating") +
    theme(plot.title = element_text(hjust = 0.5)) +
    guides(fill=guide_legend(title="chocolate"))

fruitvio <- ggplot(productreview,aes(HAS_FRUIT,Stars)) +
  geom_violin(aes(fill=HAS_FRUIT)) + 
  scale_fill_manual(values=c("grey","deeppink")) +
    labs(title="Distn of Ratings For Icecreams \nBy Contains Fruit Indicator",
       x="Contains Fruit",
       y="Rating") +
    theme(plot.title = element_text(hjust = 0.5)) +
    guides(fill=guide_legend(title="fruit"))

organicvio <- ggplot(productreview,aes(HAS_ORGANIC,Stars)) +
  geom_violin(aes(fill=HAS_ORGANIC)) + 
  scale_fill_manual(values=c("grey","chartreuse3")) +
    labs(title="Distn of Ratings For Icecreams \nBy Contains Organic Indicator",
       x="Contains Organic",
       y="Rating") +
    theme(plot.title = element_text(hjust = 0.5)) +
    guides(fill=guide_legend(title="organic"))

caramelvio <- ggplot(productreview,aes(HAS_CARAMEL,Stars)) +
  geom_violin(aes(fill=HAS_CARAMEL)) + 
  scale_fill_manual(values=c("grey","darkgoldenrod4")) +
    labs(title="Distn of Ratings For Icecreams \nBy Contains Caramel Indicator",
       x="Contains Caramel",
       y="Rating") +
    theme(plot.title = element_text(hjust = 0.5)) +
    guides(fill=guide_legend(title="caramel"))

grid.arrange(chocvio, fruitvio,
             organicvio, caramelvio,
             nrow=2)

```

```{r ingredientcounts}
choccounts <- count(productreview, HAS_CHOCOLATE)
fruitcounts <- count(productreview, HAS_FRUIT)
organiccounts <- count(productreview, HAS_ORGANIC)
caramelcounts <- count(productreview, HAS_CARAMEL)
```

Above we are able to observe the distributions of product reviews grouped by the ingredient indicators that were prepared earlier.

1. We can see that the icecream reviews seem to have similarly shaped distributions of ratings for icecreams that do and don't contain chocolate. The same cannot be said for reviews for the other ingredient indicators.

2. Reviews of icecreams containing Fruit, Organic, and Caramel ingredients represent relatively small proportions of the total icecream reviews as is evinced by their smaller violin charts.

* `Choc` -  `r choccounts$HAS_CHOCOLATE[1]`: `r choccounts$n[1]` / `r choccounts$HAS_CHOCOLATE[2]`: `r choccounts$n[2]` 
* `Fruit` - `r fruitcounts$HAS_FRUIT[1]`: `r fruitcounts$n[1]` / `r fruitcounts$HAS_FRUIT[2]`: `r fruitcounts$n[2]` 
* `Organic` - `r organiccounts$HAS_ORGANIC[1]`: `r organiccounts$n[1]` / `r organiccounts$HAS_ORGANIC[2]`: `r organiccounts$n[2]` 
* `Caramel` - `r caramelcounts$HAS_CARAMEL[1]`: `r caramelcounts$n[1]` / `r caramelcounts$HAS_CARAMEL[2]`: `r caramelcounts$n[2]` 

```{r ingredientcontingencies}



choc_contingency_table<-table(productreview$HAS_CHOCOLATE,productreview$Stars, dnn=c("HAS_CHOCOLATE", "Star Rating"))
chocmoplot<- mosaicplot(prop.table(choc_contingency_table,margin=1),
                        main="Chocolate Indicator Rating Mosaic Plot")

fruit_contingency_table<-table(productreview$HAS_FRUIT,productreview$Stars, dnn=c("HAS_FRUIT", "Star Rating"))
fruitmoplot<- mosaicplot(prop.table(fruit_contingency_table,margin=1),
                        main="Fruit Indicator Rating Mosaic Plot")

organic_contingency_table<-table(productreview$HAS_ORGANIC,productreview$Stars, dnn=c("HAS_ORGANIC", "Star Rating"))
organicmoplot<- mosaicplot(prop.table(organic_contingency_table,margin=1),
                        main="Organic Indicator Rating Mosaic Plot")

caramel_contingency_table<-table(productreview$HAS_CARAMEL,productreview$Stars, dnn=c("HAS_CARAMEL", "Star Rating"))
caramelmoplot<- mosaicplot(prop.table(caramel_contingency_table,margin=1),
                        main="Caramel Indicator Rating Mosaic Plot")

```

Above are mosaic plots for proportions of star ratings for each ingredient indicator in the product-review data. These plots yield some interesting insights into proportions of ratings for groups which contain or do not contain certain ingredients.

These apparent differences warrant additional statistical testing.

```{r ingredientchisq}
choc_chisq <- chisq.test(choc_contingency_table)
fruit_chisq <- chisq.test(fruit_contingency_table)
org_chisq <- chisq.test(organic_contingency_table)
caramel_chisq <-chisq.test(caramel_contingency_table)
```
We review the above results from the Chi-Squared independence tests for our ingredient indicators:

* __HAS_CHOCOLATE__ - The Chi-Squared test yields a p-value of `r chisq.test(choc_contingency_table)$p.value`, thus with 95% confidence we reject the null hypothesis that star rating is independent of `chocolate` ingredient content in the icecreams.
* __HAS_FRUIT__ - The Chi-Squared test yields a p-value of `r chisq.test(fruit_contingency_table)$p.value`, thus with 95% confidence we reject the null hypothesis that star rating is independent of `fruit` ingredient content in the icecreams.
* __HAS_ORGANIC__ - The Chi-Squared test yields a p-value of `r chisq.test(organic_contingency_table)$p.value`, thus with 95% confidence we fail to reject the null hypothesis that star rating is independent of `organic` ingredient content in the icecreams.
* __HAS_CARAMEL__ - The Chi-Squared test yields a p-value of `r chisq.test(fruit_contingency_table)$p.value`, thus with 95% confidence we reject the null hypothesis that star rating is independent of `caramel` ingredient content in the icecreams.

With these results in mind we can say with high confidence that for the above ingredient groupings  star rating is not independent of ingredient content (organic ingredients being a notable exception)

# References

About Breyers History. (N.d.). Breyers. Retrieved March 12, 2024, from https://www.breyers.com/us/en/about.html

About Us. (N.d.). Häagen Dazs. Retrieved March 12, 2024, from https://www.icecream.com/us/en/brands/haagen-dazs/about

Our Process. (N.d.). Talenti. Retrieved March 12, 2024, from https://www.talentigelato.com/us/en/our-process.html

Our Values, Activism, and Mission. (N.d.). Ben & Jerry's. Retrieved March 12, 2024, from https://www.benjerry.com/values

Pond, T. (2020, Sept). Ice Cream Dataset. Kaggle. Retrieved March 11, 2024, from https://www.kaggle.com/datasets/tysonpo/ice-cream-dataset/data
